<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Basique</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2563eb;
            margin-bottom: 20px;
        }
        .success {
            color: #10b981;
            font-weight: bold;
            font-size: 24px;
        }
        .link {
            display: block;
            padding: 15px;
            background: #2563eb;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        .link:hover {
            background: #1d4ed8;
        }
        pre {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>‚úÖ Tibok Medical Evaluation</h1>
        <p class="success">SI TU VOIS CETTE PAGE, LE SERVEUR FONCTIONNE !</p>
        <p>URL actuelle : <strong id="current-url"></strong></p>
        <p>Date/Heure : <strong id="datetime"></strong></p>
    </div>

    <div class="card">
        <h2>üìä Statistiques en direct</h2>
        <div id="stats">Chargement...</div>
    </div>

    <div class="card">
        <h2>üë®‚Äç‚öïÔ∏è Liste des m√©decins</h2>
        <div id="doctors">Chargement...</div>
    </div>

    <div class="card">
        <h2>üîó Liens rapides</h2>
        <a href="/static/index.html" class="link">Page d'accueil</a>
        <a href="/static/login.html" class="link">Login m√©decins</a>
        <a href="/static/simple-admin.html" class="link">Dashboard Admin</a>
        <a href="/api/health" class="link" target="_blank">API Health Check</a>
    </div>

    <div class="card">
        <h2>üêõ Debug - R√©ponse API brute</h2>
        <pre id="debug"></pre>
    </div>

    <script>
        // Afficher URL et date
        document.getElementById('current-url').textContent = window.location.href
        document.getElementById('datetime').textContent = new Date().toLocaleString('fr-FR')

        // Fonction pour afficher les erreurs clairement
        function showError(elementId, error) {
            document.getElementById(elementId).innerHTML = 
                '<p style="color:red;font-weight:bold;">‚ùå ERREUR: ' + error.message + '</p>' +
                '<p style="color:gray;font-size:12px;">' + error.stack + '</p>'
        }

        // Charger les stats
        fetch('/api/admin/stats')
            .then(response => {
                console.log('Stats Response:', response)
                return response.json()
            })
            .then(data => {
                console.log('Stats Data:', data)
                document.getElementById('debug').textContent = JSON.stringify(data, null, 2)
                
                if (data.success) {
                    document.getElementById('stats').innerHTML = `
                        <p>‚úÖ <strong>M√©decins:</strong> ${data.stats.total_doctors}</p>
                        <p>‚úÖ <strong>QCM:</strong> ${data.stats.content.total_qcm}</p>
                        <p>‚úÖ <strong>Cas cliniques:</strong> ${data.stats.content.total_cases}</p>
                    `
                }
            })
            .catch(error => {
                console.error('Stats Error:', error)
                showError('stats', error)
                document.getElementById('debug').textContent = 'ERROR: ' + error.message
            })

        // Charger les m√©decins
        fetch('/api/admin/doctors?limit=10')
            .then(response => response.json())
            .then(data => {
                console.log('Doctors Data:', data)
                
                if (data.success && data.doctors.length > 0) {
                    let html = '<table style="width:100%;border-collapse:collapse;">'
                    html += '<tr style="background:#f3f4f6;"><th style="padding:10px;text-align:left;">Nom</th><th style="padding:10px;text-align:left;">Email</th><th style="padding:10px;text-align:left;">R√¥le</th></tr>'
                    
                    data.doctors.forEach(doctor => {
                        html += `<tr style="border-bottom:1px solid #e5e7eb;">
                            <td style="padding:10px;">${doctor.name}</td>
                            <td style="padding:10px;">${doctor.email}</td>
                            <td style="padding:10px;"><span style="background:${doctor.role === 'admin' ? '#fecaca' : '#bfdbfe'};padding:2px 8px;border-radius:3px;">${doctor.role}</span></td>
                        </tr>`
                    })
                    
                    html += '</table>'
                    document.getElementById('doctors').innerHTML = html
                } else {
                    document.getElementById('doctors').innerHTML = '<p>‚ùå Aucun m√©decin trouv√©</p>'
                }
            })
            .catch(error => {
                console.error('Doctors Error:', error)
                showError('doctors', error)
            })
    </script>
</body>
</html>
